---
import Base from '@/layouts/Base.astro';
import MosaicTile from '@/components/ui/MosaicTile.astro';
import EmailForm from '@/components/ui/EmailForm.astro';
import Flourish from '@/components/ui/Flourish.astro';
import SkeletonKey from '@/components/ui/SkeletonKey.astro';
import { getCollection } from 'astro:content';

const authors = await getCollection('authors', ({ data }) => data.published);
const sortedAuthors = authors.sort((a, b) =>
  parseInt(a.data.number) - parseInt(b.data.number)
);
---

<Base title="Wingmarks" currentPage="home">
  <!-- Hero -->
  <section class="hero hero--mesh">
    <img src="/img/outside.jpg" alt="" aria-hidden="true" class="hero-bg" />
    <canvas id="rain-canvas" class="rain-canvas" aria-hidden="true"></canvas>
    <div class="hero-inner">
      <img
        src="/img/moth_wingmarks.svg"
        alt=""
        aria-hidden="true"
        class="hero-wingspan"
      />
      <div class="title-container">
        <div class="title-line">
          <h1 class="title title-1">Wingmarks</h1>
        </div>
      </div>

      <div class="tagline-container">
        <p class="tagline">
          Twenty essays on the encounters that
          <strong>rearranged us</strong>. The people, animals, and living systems that left lasting impressions.
        </p>
      </div>

      <div class="hero-cta-container">
        <a href="#signup" class="hero-cta">Get Early Access</a>
      </div>
    </div>
  </section>

  <script>
    import { initRain } from '@/lib/rain/rain-init';
    const canvas = document.getElementById('rain-canvas');
    initRain(canvas);
  </script>

  <!-- Mosaic Grid -->
  <section class="mosaic-section" id="authors">
    <div class="mosaic-header">
      <p class="mosaic-label">Open Call</p>
      <h2 class="mosaic-title">Your voice could be<br><em>one of twenty.</em></h2>
      <p class="mosaic-description">
        Wingmarks brings together twenty essayists in a collaborative collection. Each contributor
        receives a 50/50 revenue split, cross-promotion from nineteen fellow writers, and a
        premium showcase for their work.
      </p>
      <div class="mosaic-divider" aria-hidden="true">
        <Flourish variant="divider" />
      </div>
    </div>

    <div class="mosaic-grid">
      {/* Sample author tile — shows how contributors are showcased */}
      {sortedAuthors.filter(a => a.data.theme === "Sample Profile").map((author) => (
        <MosaicTile
          number={author.data.number}
          name={author.data.name}
          essayTitle={author.data.essayTitle}
          theme="See How We Showcase Authors"
          href={`/authors/${author.id}`}
        />
      ))}

      {/* CTA column — submit tile + learn more */}
      <div class="mosaic-cta-group">
        <MosaicTile
          number="02–20"
          name="19 spots remaining"
          essayTitle="yours could be next"
          theme="Submissions Open March 2"
          href="/submit"
          isPlaceholder={true}
        />
        <a href="/about" class="mosaic-learn-more">
          Learn more about Wingmarks &rarr;
        </a>
      </div>
    </div>
  </section>

  <!-- Quote -->
  <section class="quote-section" aria-label="Featured quote">
    <div class="quote-content">
      <div class="quote-mark">"</div>
      <p class="quote-text">
        We're not looking for polished perfection. We're looking for the
        encounters that rearranged you &mdash; told with honesty and craft.
      </p>
      <div class="quote-author">
        <div class="quote-author-line"></div>
        <span class="quote-author-name">The Wingmarks Editorial Team</span>
        <div class="quote-author-line"></div>
      </div>
    </div>
  </section>

  <!-- Section break -->
  <div class="section-break" aria-hidden="true">
    <SkeletonKey size="medium" />
  </div>

  <!-- Signup -->
  <section class="signup-section" id="signup">
    <div class="signup-left">
      <div class="signup-left-content">
        <h2 class="signup-title">
          Be among<br>the <em>first</em>
        </h2>
        <p class="signup-text">
          Early access. Behind-the-scenes. Exclusive previews
          before anyone else sees them.
        </p>
      </div>
    </div>

    <div class="signup-right">
      <EmailForm />
    </div>
  </section>
</Base>
